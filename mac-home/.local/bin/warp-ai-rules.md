### Warp AI 规则：增量式会话日志

将 Warp 终端变为一个智能、自动化的"工作日志本"。

---

## 一、目标（Goal）

为每个终端 Tab 绑定一个专属、持久的会话日志文件；当我输入"总结"时，只把**最新**、**有价值**的新增会话片段追加到该文件，便于回顾与检索。

## 二、核心思路（Method）

1. **一 Tab 一文件（One Tab, One File）**
   每个 Tab 绑定唯一日志文件，通过文件名 `ID` 标识，所有操作围绕此绑定进行。
2. **增量追加（Incremental Append）**
   "总结"只分析**上次总结后**的新增会话；首次总结分析全量历史。
3. **自动管理（Automatic Management）**
   首次总结自动创建并绑定文件；后续总结自动定位并追加，无需我手动管理路径与文件名。

## 三、具体执行细节（Implementation）

### A. 主指令：「总结…」

**触发**：输入中出现"总结"。

**执行步骤**：

1. **提炼增量内容**

   * 分析自上次总结以来的新增会话；若为首次，总结全部历史。
   * 产出 `<标题>`：基于**新增内容**生成 8–16 字中文标题。
   * 产出 `<摘要>`：用通俗中文总结要点；可引用关键原文；疑似密钥统一替换为 `***`。

2. **管理文件 ID**

   * 检查当前 Tab 是否已绑定文件 `ID`。
   * 已绑定：直接使用该 `<ID>`。
   * 未绑定：用 `<标题>` 生成新 `<ID>`，格式：`YYYY-MM-DD-<标题slug>`（转小写，特殊符号转连字符），并立即与当前 Tab 绑定。

3. **写入文件**

   * **路径**：`$HOME/@log/warp/<ID>.md`（仅在此目录内读写）。
   * **操作**：以 Markdown 片段形式**追加**到文件末尾：

     ```markdown
     ## <标题>
     <ISO 8601 当前时间戳>

     <摘要>
     ---
     ```

4. **回复我**

   * 成功：

     ```
     ✅ 已追加：<绝对路径> (ID: <ID>)
     ```

     然后仅展示本次新增的 Markdown 片段。
   * 失败：

     ```
     ❌ 操作失败：<中文原因解释> (修复建议：<具体操作建议>)
     ```

### B. 辅助指令

* **「当前文件」**：

  * 如已绑定：以 `ℹ️` 开头回复当前绑定的绝对路径与 `ID`。
  * 如未绑定：告知"尚未绑定，下一次'总结'将自动创建并绑定"。
* **「换到新文件」**：

  * 解除当前 Tab 的文件绑定，并回复：

    ```
    🗑️ 已解绑。下次"总结"将创建新文件。
    ```

### C. 全局约束

* **语言**：全程使用简体中文。
* **简洁**：回复清晰直达，避免冗长。
* **安全**：文件读写**仅限** `$HOME/@log/warp` 目录；禁止访问其他路径。
* **Tab 标识**：优先使用 `WARP_SESSION_ID`（如可用），否则基于 shell 进程 ID，确保每个 Tab 唯一且可继承。