# direnv 配置：进入此目录自动加载 RESTIC_PASSWORD 与默认变量
# 允许后执行：direnv allow ~/.config/restic

# 载入私密环境变量（不回显）
if [ -f ./.env.private ]; then
  set -a
  # shellcheck disable=SC1091
  source ./.env.private
  set +a
fi

# 默认远端与仓库名（可在环境里覆盖）
export RCLONE_REMOTE_NAME="${RCLONE_REMOTE_NAME:-pcloud}"
if [ -z "${RESTIC_REPO_NAME:-}" ]; then
  if command -v scutil >/dev/null 2>&1; then
    export RESTIC_REPO_NAME="restic-$(scutil --get LocalHostName 2>/dev/null || hostname)"
  else
    export RESTIC_REPO_NAME="restic-$(hostname)"
  fi
fi
export RESTIC_REPOSITORY="rclone:${RCLONE_REMOTE_NAME}:${RESTIC_REPO_NAME}"

# 文件路径（相对当前目录）
export INCLUDE_FILE="$PWD/include.txt"
export EXCLUDES_FILE="$PWD/excludes.txt"

# 备份标签与校验比例
export RESTIC_TAGS="${RESTIC_TAGS:-daily}"
export VERIFY_SUBSET="${VERIFY_SUBSET:-1%}"

# --- 以下为临时策略覆盖模板（只在需要时取消注释） ---
# 允许在电池上运行，并要求电量≥60%
# export ALLOW_ON_BATTERY=1
# export MIN_BATTERY=60

# 电池上也保持清醒（谨慎，耗电）
# export CAFFEINATE_ON_BATTERY=1

# 低电量优雅终止阈值调整为30%，每30秒检查一次
# export STOP_BATTERY=30
# export MONITOR_INTERVAL=30

# 从接电切到电池时不终止（如果你希望不中断）
# export STOP_ON_AC_LOSS=0

# 干跑（只打印命令，不实际执行）
# export DRY_RUN=1

