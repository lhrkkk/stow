"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "lhr"
email = "airhenry@gmail.com"

'$schema' = 'https://jj-vcs.github.io/jj/latest/config-schema.json'

# adapted from https://gist.github.com/pksunkara/622bc04242d402c4e43c7328234fd01c
# related article: https://pksunkara.com/thoughts/git-experts-should-try-jujutsu/
# adapted config entries are commented with [NOTE]

[ui]
merge-editor='smerge'
default-command = 'default'
# [NOTE] prefer helix
# editor = 'nvim'
editor = 'hx'
# [NOTE] prefer delta as pager
pager = ['delta', '--pager', 'less -FRX']
# diff-so-fancy doesn't preserve syntax highlight
# https://github.com/so-fancy/diff-so-fancy
# , '--diff-so-fancy']
# diff-highlight only pair lines and highlight the changed portion
# https://github.com/git/git/tree/master/contrib/diff-highlight
# # , '--diff-highlight']
# [NOTE] keybindings for builtin diff editor
# - direction keys or f to unfold/fold
# - space to select
# - c to commit
# - q to quit
diff-editor = ':builtin'
diff-formatter = ':git'
# [NOTE] use delta to format diff will confuse agents
# diff-formatter = 'delta'
graph.style = 'square'

# [NOTE] support coloring moved lines differently
# inspired by https://github.com/jj-vcs/jj/issues/76#issuecomment-2650808440
# and https://github.com/jj-vcs/jj/issues/6464
# but not working, and these are actually deprecated options
# settled on using `git diff` instead of `jj diff` if this matters
# via `just prep-delta`
# [ui.diff]
# format = "git"
# tool = "delta"

[merge-tools.delta]
diff-expected-exit-codes = [0, 1]

[git]
push-new-bookmarks = true
# [NOTE] user neutral prefix
# push-bookmark-prefix = 'jj/'
# [NOTE] Warning: Deprecated user-level config: git.push-bookmark-prefix is updated to templates.git_push_bookmark = '"jj/" ++ change_id.short()'

private-commits = 'private()'
# [NOTE] This feature writes change-id headers directly into the git commit object, and is visible to code forges upon push
# see https://blog.tangled.sh/stacking
write-change-id-header = true

[colors]
change_id = 'yellow'
'working_copy change_id' = 'yellow'

[templates]
op_log = 'builtin_op_log_comfortable'
# [NOTE] was moved from push-bookmark-prefix = 'jj/'
# not working
git_push_bookmark = '"jj/" ++ change_id.short()'

[template-aliases]
builtin_log_compact = '''
if(root,
  format_root_commit(self),
  label(if(current_working_copy, 'working_copy'),
    separate(' ',
      format_short_commit_header(self),
      if(empty, label('empty', '(empty)')),
      if(description,
        description.first_line(),
        label(if(empty, 'empty'), description_placeholder),
      ),
    ),
  ),
)
'''

'format_short_commit_header(commit)' = '''
separate(' ',
  format_short_change_id_with_hidden_and_divergent_info(commit),
  format_short_commit_id(commit.commit_id()),
  commit.bookmarks(),
  commit.tags(),
  commit.working_copies(),
  if(commit.conflict(), label('conflict', 'conflict')),
  if(config('ui.show-cryptographic-signatures').as_boolean(),
    format_short_cryptographic_signature(commit.signature())
  ),
)
'''

'format_operation(op)' = '''
concat(
  format_time_range(op.time()), "\n",
  format_short_operation_id(op.id()), "\n",
  op.description().first_line(), "\n",
  if(op.tags(), op.tags() ++ "\n")
)
'''

[revsets]
log = '(present(@) | ancestors(immutable_heads().., 2) | present(trunk())) & ~stash()'

[revset-aliases]
'stash()' = 'description(glob:"stash:*")'
'private()' = 'mutable() & (description(exact:"") | stash() | (empty() & ~merges()))'
'until(to)' = 'heads(::to & ~private())'
'until_bookmark(to)' = 'heads(::to & bookmarks())'
'branch(to)' = 'heads((::to | to::) & ~private())'
'branch_bookmark(to)' = 'heads((::to | to::) & bookmarks())'

[aliases]
# status
s = ['status']
sf = ['log', '--no-graph', '-r', '@', '-T', 'if(empty, "", diff.summary() ++ "\n")']

# log
l = ['log']
lr = ['log', '-r']
ls = ['log', '-r', 'stash()']
lp = ['log', '-r', 'private() & ~stash()']
lg = ['log', '-r', 'all()']

# default
# [NOTE] limit jj log to use no pager, occupy ~2/3 the screen, and show also elided changes
default = ['util', 'exec', '--', 'bash', '-c', 'echo "" && jj sf --no-pager && jj lg --no-pager --limit 20']

# init
init = ['git', 'init', '--colocate']

# clone
cl = ['git', 'clone', '--colocate']
clg = ['util', 'exec', '--', 'bash', '-c', 'jj cl https://github.com/$0']
clgp = ['util', 'exec', '--', 'bash', '-c', 'jj cl git@github.com:$0']
clgu = ['util', 'exec', '--', 'bash', '-c', 'jj cl git@github.com:$(jj config get user.username)/$0']
clsp = ['util', 'exec', '--', 'bash', '-c', 'jj cl git@git.sr.ht:~$0']
clsu = ['util', 'exec', '--', 'bash', '-c', 'jj cl git@git.sr.ht:~$(jj config get user.username)/$0']

# diff
d = ['diff']
dr = ['diff', '-r']

# new
n = ['new']
nm = ['new', '-m']
nt = ['new', 'trunk()']
ntm = ['new', 'trunk()', '-m']
na = ['new', '--insert-after']
nae = ['new', '--insert-after', '@']
naem = ['new', '--insert-after', '@', '-m']
nb = ['new', '--insert-before']
nbe = ['new', '--insert-before', '@']
nbem = ['new', '--insert-before', '@', '-m']

# describe
de = ['describe']
dem = ['describe', '-m']

# commit
ci = ['commit', '-i']
cm = ['commit', '-m']
cim = ['commit', '-i', '-m']
cc = ['util', 'exec', '--', 'jj-commit-ai','--api','gemini']
caic = ['util', 'exec', '--', 'jj-commit-ai', '--commit','--api','gemini']

# show
w = ['show']
ws = ['show', '--stat']

# edit
e = ['edit']
eh = ['edit', 'heads(@::)']
ep = ['prev', '--edit']
epc = ['prev', '--edit', '--conflict']
en = ['next', '--edit']
enc = ['next', '--edit', '--conflict']

# abandon
ad = ['abandon']
adb = ['abandon', '--retain-bookmarks']
adk = ['abandon', '--retain-bookmarks', '--restore-descendants']

# split
sp = ['split']
spr = ['split', '-r']
spp = ['split', '--parallel']
sppr = ['split', '--parallel', '-r']

# squash
sq = ['squash', '-i']
sqa = ['squash']
sqt = ['squash', '-i', '--into']
sqat = ['squash', '--into']
sqf = ['squash', '-i', '--from']
sqaf = ['squash', '--from']
sqr = ['squash', '-i', '-r']
sqar = ['squash', '-r']

# rebase
rb = ['rebase', '--skip-emptied']
rba = ['rebase', '--skip-emptied', '--insert-after']
rbb = ['rebase', '--skip-emptied', '--insert-before']
rbd = ['rebase', '--skip-emptied', '--destination']
rbt = ['rebase', '--skip-emptied', '--destination', 'trunk()']
rbtr = ['rebase', '--skip-emptied', '--destination', 'trunk()', '-r']
rbtw = ['rebase', '--skip-emptied', '--destination', 'trunk()', '-r', 'until(@)']
rbte = ['rebase', '--skip-emptied', '--destination', 'trunk()', '-r', '@']
rbtb = ['rebase', '--skip-emptied', '--destination', 'trunk()', '--branch']
rbta = ['rebase', '--skip-emptied', '--destination', 'trunk()', '--branch', 'all:(visible_heads() & mutable())']
rbts = ['rebase', '--skip-emptied', '--destination', 'trunk()', '--source']
rbtse = ['rebase', '--skip-emptied', '--destination', 'trunk()', '--source', '@']
rbe = ['rebase', '--skip-emptied', '--destination', '@']
rber = ['rebase', '--skip-emptied', '--destination', '@', '-r']
rbeb = ['rebase', '--skip-emptied', '--destination', '@', '--branch']
rbes = ['rebase', '--skip-emptied', '--destination', '@', '--source']
rbs = ['rebase', '--skip-emptied', '--source']
rbse = ['rebase', '--skip-emptied', '--source', '@']
rbsed = ['rebase', '--skip-emptied', '--source', '@', '--destination']
rbsea = ['rebase', '--skip-emptied', '--source', '@', '--insert-after']
rbseb = ['rebase', '--skip-emptied', '--source', '@', '--insert-before']
rbr = ['rebase', '--skip-emptied', '-r']
# [NOTE] fixed a few typos (were "unitl")
rbrw = ['rebase', '--skip-emptied', '-r', 'until(@)']
rbrwd = ['rebase', '--skip-emptied', '-r', 'until(@)', '--destination']
rbrwa = ['rebase', '--skip-emptied', '-r', 'until(@)', '--insert-after']
rbrwb = ['rebase', '--skip-emptied', '-r', 'until(@)', '--insert-before']
rbre = ['rebase', '--skip-emptied', '-r', '@']
rbred = ['rebase', '--skip-emptied', '-r', '@', '--destination']
rbrea = ['rebase', '--skip-emptied', '-r', '@', '--insert-after']
rbreb = ['rebase', '--skip-emptied', '-r', '@', '--insert-before']
rbrb = ['rebase', '--skip-emptied', '--branch']

# absorb
ab = ['absorb']
abf = ['absorb', '--from']

# restore
re = ['restore']

# bookmarks
bd = ['bookmark', 'delete']
bf = ['bookmark', 'forget']
bl = ['bookmark', 'list', '--all-remotes']
blr = ['bookmark', 'list', '-r']
blrw = ['bookmark', 'list', '-r', 'until(@)']
blrb = ['bookmark', 'list', '-r', 'branch(@)']
bmw = ['bookmark', 'move', '--from', 'until_bookmark(@)', '--to', 'until(@)']
bmb = ['bookmark', 'move', '--from', 'branch_bookmark(@)', '--to', 'branch(@)']
br = ['bookmark', 'rename']
bs = ['bookmark', 'set']
bsr = ['bookmark', 'set', '--allow-backwards', '-r']
bst = ['bookmark', 'set', '-r', 'trunk()']
bt = ['bookmark', 'track']
bu = ['bookmark', 'untrack']

# pull
f = ['util', 'exec', '--', 'bash', '-c', 'jj fo && jj rbt']
fw = ['util', 'exec', '--', 'bash', '-c', 'gh pr checks --watch $0 && jj f']
fo = ['git', 'fetch', '--all-remotes']
fa = ['util', 'exec', '--', 'bash', '-c', 'jj fo && jj rbta']
faw = ['util', 'exec', '--', 'bash', '-c', 'gh pr checks --watch $0 && jj fa']

# push
ps = ['git', 'push']
psb = ['git', 'push', '--bookmark']
psc = ['git', 'push', '--change']
pscw = ['git', 'push', '--change', 'until(@)']
pscb = ['git', 'push', '--change', 'branch(@)']
psca = ['git', 'push', '--change', 'all:(visible_heads() & ~private())']
psa = ['git', 'push', '--all']
psd = ['git', 'push', '--deleted']
# [NOTE] it's handy if you mainly work on main and push it
psm = ['util', 'exec', '--', 'bash', '-c', 'jj bs main -r @- && jj psb main']
# [NOTE] the master branch variant of psm, for working with older repos
psms = ['util', 'exec', '--', 'bash', '-c', 'jj bs master -r @- && jj psb master']

# pr
pro = ['util', 'exec', '--', 'bash', '-c', 'gh pr create --head $(jj blrb -T name)']
pr = ['util', 'exec', '--', 'bash', '-c', 'jj pscb && jj pro']
prow = ['util', 'exec', '--', 'bash', '-c', 'gh pr create --head $(jj blrw -T name)']
prw = ['util', 'exec', '--', 'bash', '-c', 'jj pscw && jj prow']

# op
ol = ['op', 'log']
or = ['op', 'restore']
ow = ['op', 'show']
owp = ['op', 'show', '--patch']

# file
fn = ['file', 'annotate']
fnr = ['file', 'annotate', '-r']
ft = ['file', 'track']
fu = ['file', 'untrack']

# workspace
wl = ['workspace', 'list']
wa = ['workspace', 'add']
wa1 = ['workspace', 'add', '--name', 'one', '.jj/workspace-one']
wa2 = ['workspace', 'add', '--name', 'two', '.jj/workspace-two']
wa3 = ['workspace', 'add', '--name', 'three', '.jj/workspace-three']
wo1 = ["util", "exec", "--", "bash", "-c",
       "cd $(jj workspace root)/.jj/workspace-one; if [ $# -eq 0 ]; then exec \"$SHELL\" -l; else \"$@\"; fi",
       ""]
wo2 = ["util", "exec", "--", "bash", "-c",
       "cd $(jj workspace root)/.jj/workspace-two; if [ $# -eq 0 ]; then exec \"$SHELL\" -l; else \"$@\"; fi",
       ""]
wo3 = ["util", "exec", "--", "bash", "-c",
       "cd $(jj workspace root)/.jj/workspace-three; if [ $# -eq 0 ]; then exec \"$SHELL\" -l; else \"$@\"; fi",
       ""]
wf = ['workspace', 'forget']
wf1 = ['workspace', 'forget', 'one']
wf2 = ['workspace', 'forget', 'two']
wf3 = ['workspace', 'forget', 'three']
wr = ['workspace', 'rename']
ww = ['workspace', 'update-stale']
ff = ['log', '-r', 'parents(@)']

# wm1 = ["util", "exec", "--", "bash", "-lc","jj new main one@ && jj bs main"]
# wm2 = ["util", "exec", "--", "bash", "-lc","jj new main two@ && jj bs main"]
# wm3 = ["util", "exec", "--", "bash", "-lc","jj new main three@ && jj bs main "]

# wm1 = ["util", "exec", "--", "bash", "-c","time jj rb -s one -d main && jj bs main -r one && jj wo1 jj new  && jj wo1 jj bs one -r @ && jj e main"]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -s two -d main && jj bs main -r two && jj wo2 jj new && jj wo2 jj bs two -r @ && jj e main"]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -s three -d main && jj bs main -r three && jj wo3 jj new && jj wo3 jj bs three -r @ && jj e main"]


# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -s one -d main && jj bs main -r one && jj wo1 jj new "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -s two -d main && jj bs main -r two && jj wo2 jj new "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -s three -d main && jj bs main -r three && jj wo3 jj new"]


### ref
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -s one -d main && jj bs main -r one "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -s two -d main && jj bs main -r two "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -s three -d main && jj bs main -r three "]

# ws1 = ["util", "exec", "--", "bash", "-lc","jj dr one && jj wo1 jj-sync && jj wo1 jj bs one"]
# ws2 = ["util", "exec", "--", "bash", "-lc","jj dr two && jj wo2 jj-sync && jj wo2 jj bs two"]
# ws3 = ["util", "exec", "--", "bash", "-lc","jj dr three && jj wo3 jj-sync && jj wo3 jj bs three"]

# 两边都要 jj ww 才能刷新。否则用 jj config set --user snapshot.auto-update-stale true 自动两边刷新
# ws1 = ["util", "exec", "--", "bash", "-lc","jj ww && jj wo1 jj-sync && jj wo1 jj bs one -r @"]
# ws2 = ["util", "exec", "--", "bash", "-lc","jj ww && jj wo2 jj-sync && jj wo2 jj bs two -r @"]
# ws3 = ["util", "exec", "--", "bash", "-lc","jj ww && jj wo3 jj-sync && jj wo3 jj bs three -r @"]

# wmsaa = ["util", "exec", "--", "bash", "-lc","jj wms1 && jj wms2 && jj wms3"]

### 更新标记，把上一个节点进行标记
# wm1 = ["util", "exec", "--", "bash", "-c","&& jj bs main -r one "]


wn1 = ["util", "exec", "--", "bash", "-c","jj wo1 jj new "]
wn2 = ["util", "exec", "--", "bash", "-c","jj wo2 jj new "]
wn3 = ["util", "exec", "--", "bash", "-c","jj wo3 jj new"]

wms1 = ["util", "exec", "--", "bash", "-c","jj wm1 && jj wsa"]
wms2 = ["util", "exec", "--", "bash", "-c","jj wm2 && jj wsa"]
wms3 = ["util", "exec", "--", "bash", "-c","jj wm3 && jj wsa"]

# # --------------1.1s wnsa
# ## v1 第一个工作的 new 版本，但是 one，two，three 指向 @，是先合并再 new。work well
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one -d main && jj bs main -r one && jj wo1 jj new "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two -d main && jj bs main -r two && jj wo2 jj new "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three -d main && jj bs main -r three && jj wo3 jj new"]

# # 移动头部
# ws1 = ["util", "exec", "--", "bash", "-c","jj wo1 jj-sync && jj wo1 jj bs one -r @"]
# ws2 = ["util", "exec", "--", "bash", "-c","jj wo2 jj-sync && jj wo2 jj bs two -r @"]
# ws3 = ["util", "exec", "--", "bash", "-c","jj wo3 jj-sync && jj wo3 jj bs three -r @"]

# # 同步所有工作区分支
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj ws2 && jj ws3"]

# wnsa = ["util", "exec", "--", "bash", "-c","jj wm1 && jj wm2 && jj wm3 && jj wsa && jj e main"]



# # --------------1.5s wnsa  0.7s wmsa
# ### v2 第一个工作的 @- 版本。work well
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one -d main && jj bs main -r one "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two -d main && jj bs main -r two "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three -d main && jj bs main -r three "]

# ws1 = ["util", "exec", "--", "bash", "-c","jj wo1 jj-sync && jj wo1 jj bs one -r @-"]
# ws2 = ["util", "exec", "--", "bash", "-c","jj wo2 jj-sync && jj wo2 jj bs two -r @-"]
# ws3 = ["util", "exec", "--", "bash", "-c","jj wo3 jj-sync && jj wo3 jj bs three -r @-"]

# # 同步所有工作区分支
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj ws2 && jj ws3"]

# #### wmsa = ["util", "exec", "--", "bash", "-c","jj wsa && jj wm1 && jj wm2 && jj wm3 && jj wsa   && pwd"]
# wmsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj wm1 && jj ws2 &&jj wm2 && jj ws3 && jj wm3 && jj wsa && jj e main"]

# wnsa = ["util", "exec", "--", "bash", "-c","jj wo1 jj new && jj wo2 jj new && jj wo3 jj new&&jj wsa && jj wm1 &&jj wm2 && jj wm3 && jj wsa && jj e main"]


# # --------------1.0s wnsa 0.4s wmsa 1.0wmsa
# ### v3 改进性能的 v2 版本，合并只 set 不重复 sync，仍然具有 main，one，two，three 标签。work good。
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one -d main && jj bs main -r one "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two -d main && jj bs main -r two "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three -d main && jj bs main -r three "]

# ws1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@ -d main && jj wo1 jj bs one -r @-"]
# ws2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@ -d main && jj wo2 jj bs two -r @-"]
# ws3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@ -d main && jj wo3 jj bs three -r @-"]

# wset1 = ["bookmark","set","one", "-r", "one@-"]
# wset2 = ["bookmark","set","two", "-r", "two@-"]
# wset3 = ["bookmark","set","three", "-r", "three@-"]

# # 同步所有工作区分支
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj ws2 && jj ws3"]
# wseta = ["util", "exec", "--", "bash", "-c","jj wset1 && jj wset2 && jj wset3"]

# wmsa = ["util", "exec", "--", "bash", "-c","jj wset1 && jj wm1 && jj wset2 &&jj wm2 && jj wset3 && jj wm3 && jj wsa && pwd"]
# wnsa = ["util", "exec", "--", "bash", "-c","jj wn1 && jj wn2 && jj wn3 &&jj wseta && jj wm1 &&jj wm2 && jj wm3 && jj wsa && jj e main"]


# # --------------0.9s wnsa  0.3s wmsa
# ### v3.5 并行性能的 v3 版本，仍然具有 main，one，two，three 标签。并行有时候有问题。
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one -d main && jj bs main -r one "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two -d main && jj bs main -r two "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three -d main && jj bs main -r three "]

# ws1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@ -d main && jj wo1 jj bs one -r @-"]
# ws2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@ -d main && jj wo2 jj bs two -r @-"]
# ws3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@ -d main && jj wo3 jj bs three -r @-"]

# wset1 = ["bookmark","set","one", "-r", "one@-"]
# wset2 = ["bookmark","set","two", "-r", "two@-"]
# wset3 = ["bookmark","set","three", "-r", "three@-"]

# # 同步所有工作区分支
# wna = ["util", "exec", "--", "bash", "-c","jj wn1 & jj wn2 & jj wn3 & wait"]
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 & jj ws2 & jj ws3 & wait"]
# wseta = ["util", "exec", "--", "bash", "-c","jj wset1 & jj wset2 & jj wset3 & wait"]

# wmsa = ["util", "exec", "--", "bash", "-c","jj wset1 && jj wm1 && jj wset2 &&jj wm2 && jj wset3 && jj wm3 && jj wsa && pwd"]
# wnsa = ["util", "exec", "--", "bash", "-c","jj wna &&jj wseta && jj wm1 &&jj wm2 && jj wm3 && jj wsa && jj e main"]



# # -------------- 0.8s wnsa  0.25s wmsa
# ### v4, 极致性能的 @- 版本，依赖 main 标签和one@, two@, three@，  wnsa 则是 new 版本。work well
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@- -d main && jj bs main -r one@- "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@- -d main && jj bs main -r two@- "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@- -d main && jj bs main -r three@- "]

# ws1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@ -d main "]
# ws2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@ -d main "]
# ws3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@ -d main "]

# # 同步所有工作区分支
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj ws2 && jj ws3"]

# wmsa = ["util", "exec", "--", "bash", "-c","jj wm1 &&jj wm2 && jj wm3 && jj wsa && jj e main"]
# wnsa = ["util", "exec", "--", "bash", "-c","jj wn1 && jj wn2 && jj wn3 && jj wm1 &&jj wm2 && jj wm3 && jj wsa && jj e main"]

# -------------- 0.7s wnsa  0.23s wmsa 0.9 wmsa
### v4.5, 并行性能的 @- 版本，依赖 main 标签和one@, two@, three@，  wnsa 则是 new 版本。work well
# 同步所有工作区分支
ws1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@ -d main "]
ws2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@ -d main "]
ws3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@ -d main "]

wsa = ["util", "exec", "--", "bash", "-c","jj ws1 & jj ws2 & jj ws3& wait"]

### 合并所有工作区分支，先 sa 同步
wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@- -d main && jj bs main -r one@- "]
wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@- -d main && jj bs main -r two@- "]
wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@- -d main && jj bs main -r three@- "]

wma = ["util", "exec", "--", "bash", "-c","jj wm1 && jj wm2 && jj wm3"]
wmsa = ["util", "exec", "--", "bash", "-c","jj wma && jj wsa && jj e main"]


# 立即合并所有分支当前的 @ ，创建 new 节点。适合清空分支，建立新工作区。
wna = ["util", "exec", "--", "bash", "-c","jj wn1 & jj wn2 & jj wn3& wait"]
wnsa = ["util", "exec", "--", "bash", "-c","jj wna && jj wma && jj wsa && jj e main"]



# # --------------
# ### v6 并行性能的简单主线 new 版本。只有抓取和移动。
# nm1 = ["util", "exec", "--", "bash", "-c","jj bs last && jj new && jj rbd one@"]
# nm2 = ["util", "exec", "--", "bash", "-c","jj bs last && jj new && jj rbd two@ "]
# nm3 = ["util", "exec", "--", "bash", "-c","jj bs last && jj new && jj rbd three@"]


# # nm1 = ["util", "exec", "--", "bash", "-c","jj new @ one@"]
# # nm2 = ["util", "exec", "--", "bash", "-c","jj new @ two@ "]
# # nm3 = ["util", "exec", "--", "bash", "-c","jj new @ three@"]

# # zs1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@ -d default@ "]
# # zs2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@ -d default@ "]
# # zs3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@ -d default@ "]


# zn1 = ["util", "exec", "--", "bash", "-c","jj wo1 jj new default@"]
# zn2 = ["util", "exec", "--", "bash", "-c","jj wo2 jj new default@"]
# zn3 = ["util", "exec", "--", "bash", "-c","jj wo3 jj new default@"]
# # zs1 = ["util", "exec", "--", "bash", "-c","jj wo1 jj new default@ "]

# # 同步所有工作区分支
# nma = ["util", "exec", "--", "bash", "-c","jj nm1 && jj nm2 && jj nm3"]
# zna = ["util", "exec", "--", "bash", "-c","jj zn1 && jj zn2 && jj zn3"]
# znma = ["util", "exec", "--", "bash", "-c","jj nma && jj zna && jj clean"]




##### 推荐用 v3 或者 v4.5。    v6行为不一样，作为备用
# v3   -------------- 1.0s wnsa  0.4s wmsa  1.0wmsa
# v4.5 -------------- 0.7s wnsa  0.23s wmsa  0.9wmsa



# --------------
# ### v5 错误版本
# wm1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@- -d main && jj bs main -r one@- "]
# wm2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@- -d main && jj bs main -r two@- "]
# wm3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@- -d main && jj bs main -r three@- "]

# ws1 = ["util", "exec", "--", "bash", "-c","jj rb -b one@- -d main"]
# ws2 = ["util", "exec", "--", "bash", "-c","jj rb -b two@- -d main"]
# ws3 = ["util", "exec", "--", "bash", "-c","jj rb -b three@- -d main"]


# # 同步所有工作区分支
# wsa = ["util", "exec", "--", "bash", "-c","jj ws1 && jj ws2 && jj ws3"]

# # wmsa = ["util", "exec", "--", "bash", "-c","jj wsa && jj wm1 && jj wm2 && jj wm3 && jj wsa   && pwd"]
# wmsa = ["util", "exec", "--", "bash", "-c","jj wm1 && jj wm2 && jj wm3 && jj wsa && pwd"]







# 删除所有空节点，非静态，非 bookmark
# clean = ["util", "exec", "--", "bash", "-lc","jj abandon -r 'empty() & ~merges() & mutable() & ~bookmarks() & ~remote_bookmarks()'"]

clean = ["util","exec","--","bash","-lc","jj abandon -r 'empty() & ~merges() & mutable() & ~bookmarks() & ~remote_bookmarks() & ~working_copies()'"]

cut = ["util","exec","--","bash","-lc","jj abandon -r 'mutable() & ~::(bookmarks() | working_copies())'"]


gc = ["util", "gc" ,"--expire", "now"]



#wo1 = ["util", "exec", "--", "bash", "-lc", "cd .jj/workspace-one; \"$@\"", ""]
#wo2 = ["util", "exec", "--", "bash", "-lc", "cd .jj/workspace-two; \"$@\"", ""]
#wo3 = ["util", "exec", "--", "bash", "-lc", "cd .jj/workspace-three; \"$@\"", ""]
#wo1 = ['util', 'exec', '--', 'bash', '-c', 'cd .jj/workspace-one']
#wo2 = ['util', 'exec', '--', 'bash', '-c', 'cd .jj/workspace-two']
#wo3 = ['util', 'exec', '--', 'bash', '-c', 'cd .jj/workspace-three']

r = ["util", "exec", "--", "bash", "-c", "echo args: $@; echo 0=$0 1=$1"]
# 末尾这个空字符串会占用 $0，让你的实参从 $1 开始


# [NOTE] muscle memory of jj + space
# [NOTE] show all revisions, same as my `jj`
ui =  ['util', 'exec', '--', 'bash', '-c', 'jjui -r "all()"']

[lazyjj]
# Solarized Light theme configuration
highlight-color = "#cbcfd4"
diff-format = "color-words"     # Better for light themes
layout = "horizontal"           # Classic horizontal layout
layout-percent = 50             # Balanced split

[snapshot]
auto-update-stale = true
